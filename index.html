<!DOCTYPE html>
<html lang="pl">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>OAPP v3</title>
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#003264">
    <link rel="stylesheet" href="style.css">
    <link rel="icon" type="image/png" href="icon-192.png">
    <!-- PWA iOS settings -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="OAPP v3">
</head>

<body>

    <div id="app">
        <!-- Zapotrzebowania View -->
        <div id="view-orders" class="view active">
            <header>
                <h1>Zapotrzebowania</h1>
                <button id="refresh-orders" class="refresh-btn" aria-label="Od≈õwie≈º">‚Üª</button>
            </header>

            <div class="content">
                <section class="add-form-section">
                    <button class="toggle-form-btn" onclick="toggleForm('orders-form-container')">+ Nowe
                        Zapotrzebowanie</button>
                    <div id="orders-form-container" class="form-container hidden">
                        <form id="orders-form">
                            <input type="text" name="co" placeholder="Co potrzeba? *" required>
                            <input type="text" name="ilosc" placeholder="Ilo≈õƒá *" required>
                            <input type="text" name="producent" placeholder="Producent (opcjonalnie)">
                            <input type="text" name="autor" placeholder="Autor (opcjonalnie)">
                            <textarea name="uwagi" placeholder="Uwagi (opcjonalnie)"></textarea>
                            <button type="submit" class="submit-btn">Dodaj</button>
                        </form>
                    </div>
                </section>

                <div class="kanban-board" id="orders-board">
                    <!-- Columns will be injected by JS -->
                </div>
            </div>
        </div>

        <!-- Pytania View -->
        <div id="view-items" class="view">
            <header>
                <h1>Pytania</h1>
                <button id="refresh-items" class="refresh-btn" aria-label="Od≈õwie≈º">‚Üª</button>
            </header>

            <div class="content">
                <section class="add-form-section">
                    <button class="toggle-form-btn" onclick="toggleForm('items-form-container')">+ Nowe Pytanie</button>
                    <div id="items-form-container" class="form-container hidden">
                        <form id="items-form">
                            <input type="text" name="opis" placeholder="Tre≈õƒá pytania *" required>
                            <input type="date" name="termin_odpowiedzi" placeholder="Termin odpowiedzi">
                            <select name="priorytet">
                                <option value="Niski">Niski</option>
                                <option value="≈öredni" selected>≈öredni</option>
                                <option value="Wysoki">Wysoki</option>
                            </select>
                            <input type="text" name="autor" placeholder="Autor (opcjonalnie)">
                            <button type="submit" class="submit-btn">Dodaj</button>
                        </form>
                    </div>
                </section>

                <div class="kanban-board" id="items-board">
                    <!-- Columns will be injected by JS -->
                </div>
            </div>
        </div>

        <!-- Pliki View -->
        <div id="view-docs" class="view">
            <header>
                <h1>Pliki (Drive)</h1>
            </header>
            <div class="content docs-content">
                <div class="drive-embed-container">
                    <iframe src="https://drive.google.com/embeddedfolderview?id=1iURUi0OKIleXiPBbYsfZSKutvIRBJWmS#grid"
                        class="drive-frame" title="Pliki Google Drive" allowfullscreen>
                    </iframe>
                </div>
                <a href="https://drive.google.com/drive/folders/1iURUi0OKIleXiPBbYsfZSKutvIRBJWmS?usp=sharing"
                    target="_blank" class="drive-btn">
                    üìÇ Otw√≥rz folder w Google Drive
                </a>
            </div>
        </div>

        <!-- Chat AI View -->
        <div id="view-chat" class="view">
            <header>
                <h1>Chat AI</h1>
            </header>
            <div class="content chat-content">
                <div class="chat-main-area">
                    <button id="open-chat-btn" class="chat-open-btn">
                        ü§ñ Otw√≥rz Chat AI
                    </button>
                    <p class="chat-hint">Otwiera NotebookLM w nowej karcie</p>
                </div>
            </div>
        </div>

        <!-- Ustawienia View -->
        <div id="view-settings" class="view">
            <header>
                <h1>Ustawienia</h1>
            </header>
            <div class="content settings-content">
                <div class="chat-settings">
                    <div class="setting-group">
                        <label for="user-name-input">U≈ºytkownik (Autor)</label>
                        <input type="text" id="user-name-input" placeholder="Twoje imiƒô / nazwisko">
                        <p class="setting-hint">Automatycznie uzupe≈Çnia pole "Autor"</p>
                    </div>

                    <div class="setting-group">
                        <label for="chat-link-input">Link do Chat AI (NotebookLM)</label>
                        <input type="text" id="chat-link-input" placeholder="Wklej link do notatnika...">
                    </div>

                    <div class="settings-actions">
                        <button id="test-connection-btn" class="test-conn-btn">üì° Testuj po≈ÇƒÖczenie</button>
                        <button id="save-settings-btn" class="save-settings-btn">Zapisz ustawienia</button>
                    </div>

                    <div class="links-section">
                        <h2>Zapisane Linki</h2>
                        <ul id="links-list"></ul>
                        <button class="add-link-btn" onclick="addNewLink()">+ Dodaj link</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Bottom Navigation -->
        <nav class="bottom-nav">
            <button class="nav-btn active" data-target="view-orders">
                <span class="icon">üì¶</span>
                <span class="label">Zapotrzebowania</span>
            </button>
            <button class="nav-btn" data-target="view-items">
                <span class="icon">‚ùì</span>
                <span class="label">Pytania</span>
            </button>
            <button class="nav-btn" data-target="view-docs">
                <span class="icon">üìÇ</span>
                <span class="label">Pliki</span>
            </button>
            <button class="nav-btn" data-target="view-chat">
                <span class="icon">ü§ñ</span>
                <span class="label">Chat AI</span>
            </button>
            <button class="nav-btn" data-target="view-settings">
                <span class="icon">‚öôÔ∏è</span>
                <span class="label">Ustawienia</span>
            </button>
        </nav>
    </div>

    <div id="toast-container"></div>

    <script src="storage.js"></script>
    <script src="api.js"></script>
    <script src="app.js"></script>
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('./sw.js')
                    .then(reg => {
                        console.log('[OAPP] SW registered!', reg);
                        // Check for updates
                        reg.addEventListener('updatefound', () => {
                            const newWorker = reg.installing;
                            newWorker.addEventListener('statechange', () => {
                                if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                                    console.log('[OAPP] New version initialized');
                                }
                            });
                        });
                    })
                    .catch(err => console.log('[OAPP] SW registration failed', err));
            });
        }
    </script>
</body>

</html>